

# ğŸ† Challenge: Update Books with PATCH

## ğŸ¯ Goal

Create a **PATCH API** for updating a book by its ID.

---

## ğŸ“ Instructions

1. Inside `app/books/[id]/route.ts`, add a `PATCH` method.
2. Parse request body (`title`, `author`) from JSON.
3. Update only provided fields â€” keep old ones if not included.
4. Return updated book if found, otherwise return `{ "error": "Book not found" }` with status `404`.

---

## ğŸ“‚ Example db.ts

```ts
export const books = [
  { id: 1, title: "Atomic Habits", author: "James Clear" },
  { id: 2, title: "The Pragmatic Programmer", author: "Andrew Hunt" },
  { id: 3, title: "Clean Code", author: "Robert C. Martin" },
];
```

---

## âœ… Expected Behavior

* **PATCH `/books/1`**

```json
{
  "title": "Atomic Habits (Updated)"
}
```

ğŸ‘‰ Returns updated book with new title.

* **PATCH `/books/99`**

```json
{
  "error": "Book not found"
}
```

with status `404`.

---

## ğŸ“ Solution

### app/books/\[id]/route.ts

```ts
import { books } from "../../../db";

export async function PATCH(
  request: Request,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id } = await params;
    const bookId = +id;

    // Find existing book
    const book = books.find((b) => b.id === bookId);
    if (!book) {
      return new Response(JSON.stringify({ error: "Book not found" }), {
        status: 404,
        headers: { "Content-Type": "application/json" },
      });
    }

    // Parse body
    const body = await request.json();

    // Update only provided fields
    const updatedBook = {
      ...book,
      title: body.title ?? book.title,
      author: body.author ?? book.author,
    };

    // Replace in DB
    const index = books.findIndex((b) => b.id === bookId);
    books[index] = updatedBook;

    return new Response(JSON.stringify(updatedBook), {
      status: 200,
      headers: { "Content-Type": "application/json" },
    });
  } catch (error) {
    return new Response(JSON.stringify({ error: "Failed to parse JSON" }), {
      status: 400,
      headers: { "Content-Type": "application/json" },
    });
  }
}
```
