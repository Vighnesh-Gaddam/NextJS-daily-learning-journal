# ğŸ¬ Notes: Server vs Client Components in Next.js

## ğŸ”¹ By Default

* In **Next.js App Router**, every component is a **Server Component**.
* To make a component a **Client Component**, add at the top:

```tsx
"use client";
```

---

## ğŸ”¹ Server Components

* Run **only on the server**.
* Cannot use:

  * `useState`, `useEffect`, or any React hooks.
  * Event handlers (`onClick`, `onChange`, etc.).
* Best for:

  * **Data fetching**
  * **Backend logic**
  * **Private/confidential code** (API keys, tokens)
  * **SEO-friendly pages**
  * **Large dependencies** (reduce client JS bundle size)

ğŸ‘‰ Example:

```tsx
export default function Movies() {
  console.log("Runs on server");
  return <h1>Movies Page</h1>;
}
```

---

## ğŸ”¹ Client Components

* Made interactive with `"use client"`.
* Can use:

  * `useState`, `useEffect`, `useReducer`, custom hooks
  * Event handlers (`onClick`, `onChange`)
  * Browser APIs (`localStorage`, `window`)
  * Animations & effects
* Best for:

  * **Interactivity**
  * **State management**
  * **Client-side logic/UI**

ğŸ‘‰ Example:

```tsx
"use client";

import { useState } from "react";

export default function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>Count: {count}</button>;
}
```

---

## ğŸ”¹ Errors to Remember

1. âŒ Using `useState` or `useEffect` in a Server Component â†’ **Error**
2. âŒ Adding `onClick` in a Server Component â†’ **Error**
3. âœ… Fix â†’ Add `"use client";` at the top.

---

## ğŸ”¹ Server-Only Code

* Sometimes you need code that **must never run on client** (e.g., DB queries, secret APIs).
* Issue: By default, helper functions (`utils/`) can be imported into client components too.
* **Fix:** Use the `server-only` package.

```bash
npm i server-only
```

```ts
// utils/db.ts
import "server-only";

export async function getUser(id: string) {
  // Safe: can only be used in server components
}
```

ğŸ‘‰ If you import this in a client component, it throws an **error**.

---

## ğŸ”¹ Client-Only Code

* Similarly, restrict code to **only client components**.
* Install package:

```bash
npm i client-only
```

```ts
// utils/client.ts
import "client-only";

export function playSound() {
  return new Audio("/sound.mp3").play();
}
```

ğŸ‘‰ If imported into a server component â†’ **error**.

---

## ğŸ”¹ Parent Affecting Children

* If a **parent is a client component** (`"use client"` at top):

  * **All child components automatically become client components**.

ğŸ‘‰ Example:

```tsx
// Dashboard.tsx
"use client";

import Settings from "./Settings";

export default function Dashboard() {
  return <Settings />;
}
```

ğŸ‘‰ Here, `Settings` is **client too**, even without `"use client"`.

---

## ğŸ”¹ Client-Side Data Fetching

Steps to fetch data inside client components:

1. Mark file with `"use client"`.

2. Import `useState` and `useEffect`.

3. Define state:

   * `users` (data)
   * `loading` (boolean)
   * `error` (string/null)

4. Fetch inside `useEffect`:

```tsx
"use client";
import { useState, useEffect } from "react";

export default function Users() {
  const [users, setUsers] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        setError(null);
        const res = await fetch("https://jsonplaceholder.typicode.com/todos/1");
        if (!res.ok) throw new Error("Failed to fetch data");
        const data = await res.json();
        setUsers(data);
      } catch (err: any) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, []);

  if (loading) return <p>Loading...</p>;
  if (error) return <p>{error}</p>;
  return <pre>{JSON.stringify(users, null, 2)}</pre>;
}
```

---

## âš¡ In Short

* **Server Components** = Default, fast, secure, great for fetching data & SEO, but no interactivity.
* **Client Components** = `"use client"`, interactive, stateful, can use browser APIs.
* Use **`server-only`** to lock code to server.
* Use **`client-only`** to lock code to client.
* **Parent client component â†’ all children become client too**.
* Client-side fetching requires **state + effect + error/loading handling**.

---

