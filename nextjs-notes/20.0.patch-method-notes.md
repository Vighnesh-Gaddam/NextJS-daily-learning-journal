# ðŸŽ¬ Notes: PATCH Method in Next.js (Backend)

## ðŸ“Œ What is PATCH?

* **PATCH** is an HTTP method used to **partially update** an existing resource.
* Unlike `PUT` (which replaces the entire resource), `PATCH` allows updating only the fields provided.

ðŸ‘‰ Example use case: Update a **movieâ€™s title or rating** without changing other fields.

---

## ðŸ›  Steps to Implement PATCH in Next.js

### 1. Inside Dynamic Route

File: `app/movies/[id]/route.ts`

```ts
import { movies } from "../../../db";

export async function PATCH(
  request: Request,
  { params }: { params: { id: string } }
) {
  try {
    const movieId = +params.id;

    // Find existing movie
    const movie = movies.find((m) => m.id === movieId);
    if (!movie) {
      return new Response(JSON.stringify({ error: "Movie not found" }), {
        status: 404,
        headers: { "Content-Type": "application/json" },
      });
    }

    // Parse request body
    const body = await request.json();

    // Update fields if provided, otherwise keep old ones
    const updatedMovie = {
      ...movie,
      title: body.title ?? movie.title,
      rating: body.rating ?? movie.rating,
      genre: body.genre ?? movie.genre,
    };

    // Find index & update in DB (mock)
    const index = movies.findIndex((m) => m.id === movieId);
    movies[index] = updatedMovie;

    return new Response(JSON.stringify(updatedMovie), {
      status: 200,
      headers: { "Content-Type": "application/json" },
    });
  } catch (error) {
    return new Response(JSON.stringify({ error: "Failed to parse JSON" }), {
      status: 400,
      headers: { "Content-Type": "application/json" },
    });
  }
}
```

---

## ðŸ§ª Testing with Thunder Client / Postman

* **PATCH `/movies/1`**

```json
{
  "title": "Amazing Action Movie",
  "rating": 5
}
```

ðŸ‘‰ Updates only `title` and `rating`, keeps `genre` unchanged.

* **PATCH `/movies/100`**

```json
{
  "error": "Movie not found"
}
```

with status `404`.

---

## âœ… Key Points

* Always **check if resource exists** before updating.
* Use `request.json()` to parse body.
* Use `??` (nullish coalescing) to keep old values if new ones arenâ€™t provided.
* Return **status 200** for success, **404** for not found, **400** for bad request.

---